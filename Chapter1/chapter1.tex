%!TEX root = ../thesis.tex
%*******************************************************************************
%*********************************** First Chapter *****************************
%*******************************************************************************

\chapter{Formulations of Einstein Field Equations}  %Title of the Second Chapter

\ifpdf
    \graphicspath{{Chapter1/Figs/PDF/}{Chapter1/Figs/}}
\else
    \graphicspath{{Chapter1/Figs/}}
\fi


%********************************** %First Section  **************************************
\section{Introduction to general relativity} %Section - 1.1
\label{section1.1}

\subsection{Einstein field equations} %Section - 1.1.1
\label{section1.1.1}

The Einstein field equations is given by
\begin{align} \label{eq:Einstein_eq}
    G_{\mu\nu} = 8 \pi T_{\mu\nu},
\end{align}
where $T_{\mu\nu}$ is the enery-momentum tensor and $G_{\mu\nu}$ is the Einstein tensor.
The Einstein tensor $G_{\mu\nu}$ is defined as
\begin{align}
    G_{\mu\nu} \coloneqq R_{\mu\nu} - \frac{1}{2} g_{\mu\nu} R,
\end{align}
where $R_{\mu\nu}$ is the Ricci tensor,
$R$ is the Ricci scalar
and $g_{\mu\nu}$ is the metric tensor.

%\subsection{Relativistic Star} %Section - 1.1.2
%\label{section1.1.2}

%********************************** %Second Section  *************************************
\section{The 3+1 decomposition of spacetime} %Section - 1.2 
\label{section1.2}

Due to the complexity and nonlinearity of Einstein field equations, it is extremely difficult to obtain analytical solution even for the simplest dynamical evolution systems.
Therefore, the accurate description of the such systems can only be derived through numerical simulation.
For this, we need to reformulate the Einstein equations as an initial-value problem or Cauchy problem.
In this chapter, we will introduction the Arnowitt-Deser-Misner (ADM) formulation, which is one of the milestone of 3+1 numerical relativity.
In particular, we will focus on the constrained evolution scheme for the Einstein equations.
For more comprehensive discussion of numerical relativity,
we refer readers to \cite{shibata2015numerical,baumgarte2010numerical,gourgoulhon20123+}.

\subsection{Foliation of spacetime} \label{section1.2.1}

In the 3+1 decomposition, the spacetime manifold $\mathcal{M}$ is foliated into a set of non-intersecting spacelike hypersurfaces $\Sigma_t$ parameterized by the coordinate time $t$ \cite{misner1973gravitation}.
We denote a future-directed timelike unit four-vector $n^\mu$ normal to the hypersurface $\Sigma_t$ (i.e. $n_{\mu} \propto \nabla_\mu t$).
The induced spacetime metric $\gamma_{\mu\nu}$ on each hypersurfuce can then be defined as
\begin{align}\label{eq:1.2.spatial}
    \gamma_{\mu\nu} \coloneqq g_{\mu\nu} + n_{\mu} n_{\nu}.
\end{align}
Thus, we can construct spatial projection tensor $\gamma^{\mu}{}_{\nu}$ and time projection tensor $N^{\mu}{}_{\nu}$ as
\begin{align}
    \gamma^{\mu}{}_{\nu} &\coloneqq \delta^{\mu}{}_{\nu} + n^{\mu} n_{\nu}, & N^{\mu}{}_{\nu} &\coloneqq - n^{\mu} n_{\nu},
\end{align}
which decompose any generic four-vector $U^\mu$ into spatial part $\gamma^{\mu}{}_{\nu}U^{\nu}$ and timelike part $N^{\mu}{}_{\nu}U^{\nu}$.
Therefore, we can decompose the timelike vector field
\begin{align}\label{eq:1.2.1.normal_decompose}
t^\mu = \alpha n^{\mu} + \beta^{\mu}
\end{align}
into two components as
\begin{align}
    \alpha &\coloneqq - t^\mu n_\mu, & \beta^{\mu} &\coloneqq t^{\nu} \gamma^{\mu}{}_{\nu},
\end{align}
where the lapse function $\alpha$ measures the physical proper time ($\alpha\Delta t$) between two neighboring spatial hypersurface $\Sigma_t$ and $\Sigma_{t+\Delta t}$
, and the shift vector $\beta^i$ measures the changes of spatial coordinates on $\Sigma_{t+\Delta t}$.\\
Here, we summarize several useful relations.
The timelike normal vector $n^\mu$ and its corresponding one-form $n_\mu$ can be expressed as
\begin{align} \label{eq:1.2.1.normal}
    n^\mu &= \frac{1}{\alpha}\left(1, \beta^i \right), & n_\mu &= \left(\alpha, \vec{0}, \right).
\end{align}
The generic line element in 3+1 decomposition is given by
\begin{align}
    ds^2 = - \left( \alpha^2 - \beta^i \beta_i \right) dt^2 + \beta_i dx^i dt + \gamma_{ij} dx^i dx^j
\end{align}
The covariant and contravariant components of the metric can be written as
\begin{align}\label{eq:1.2.1.g}
    g_{\mu\nu} &= 
    \begin{pmatrix}
        - \alpha^2 + \beta^i \beta_i & \beta_j \\
        \beta_i & \gamma_{ij}
    \end{pmatrix}, &
    g^{\mu\nu} &= 
    \begin{pmatrix}
        - \frac{1}{\alpha^2} & \frac{\beta^j}{\alpha^2} \\
        \frac{\beta^i}{\alpha^2} & \gamma^{ij} - \frac{\beta^i \beta^j}{\alpha^2}
    \end{pmatrix}.
\end{align}
From equation(\ref{eq:1.2.1.g}), we can conclude that
\begin{align}
    \sqrt{-g} = \alpha \sqrt{\gamma},
\end{align}
where $g \coloneqq \det{\left(g_{\mu\nu}\right)}$ and $\gamma \coloneqq \det{\left(\gamma_{ij}\right)}$.

\subsection{Derivative operator} \label{section1.2.2}
With the 3+1 decomposition, we can now construct the 3-dimensional covariant derivative $D_\alpha$ associated with $\gamma_{\mu\nu}$ by projecting the 4-dimensional covariant derivative $\nabla_\alpha$ onto $\Sigma_t$, which is given by
\begin{align}\label{eq:1.2.2.spatialD}
    D_{\alpha} T^{\mu_1 \mu_2 \dots}{}_{\nu_1 \nu_2 \dots} = \gamma_{\alpha}{}^{\beta}\gamma_{\rho_1}{}^{\mu_1} \gamma_{\rho_2}{}^{\mu_2} \dots \gamma_{\nu_1}{}^{\sigma_1} \gamma_{\nu_2}{}^{\sigma_2} \dots \nabla_{\beta} T^{\rho_1 \rho_2 \dots}{}_{\sigma_1 \sigma_2 \dots},
\end{align}
for arbitrary tensor $T^{\mu_1 \mu_2 \dots}{}_{\nu_1 \nu_2 \dots}$ on spatial hypersurface $\Sigma_t$.
Using equation(\ref{eq:1.2.2.spatialD}), it can be shown that the corvariant derivative of $\gamma_{\mu\nu}$ vanishes
\begin{align}
\begin{split}
    D_{\alpha} \gamma_{\mu\nu} &= \gamma_{\alpha}{}^{\beta} \gamma_{\rho}{}^{\mu} \gamma_{\nu}{}^{\sigma} \nabla_{\beta} \left(g_{\rho\sigma} + n_\rho n_\sigma \right) \\
    &= \gamma_{\alpha}{}^{\beta} \gamma_{\rho}{}^{\mu} \gamma_{\nu}{}^{\sigma} \left( n_\rho \nabla_\beta n_\sigma + n_\sigma \nabla_\beta n_\rho \right) = 0
\end{split}
\end{align}
The components of 3-dimensional connection coefficients $\Gamma^{\alpha}{}_{\mu\nu}$ in coordinate basis can be expressed as
\begin{align}\label{eq:3_connection}
    \Gamma^{\alpha}{}_{\mu\nu} &= \frac{1}{2} \gamma^{\alpha\beta} \left( \partial_{\nu}\gamma_{\beta\mu} + \partial_{\mu}\gamma_{\beta\nu} - \partial_{\beta}\gamma_{\mu\nu} \right).
\end{align}
Here, the upper left index ${}^{(4)}$ marks the 4-dimensional tensors while the unmarked one represents purely spatial 3-dimensional tensors.
Similarly, the 3-dimensional Riemann tensor $R^{\alpha}{}_{\beta\mu\nu}$ associated with $\gamma_{\mu\nu}$ is defined by requiring that
\begin{align}
    D_{\nu} D_{\mu} W_\beta - D_{\mu} D_{\nu} W_\beta &= W_\alpha R^\alpha{}_{\beta\mu\nu}, & R^{\alpha}{}_{\beta\mu\nu} n_\alpha &= 0,
\end{align}
which can be explicitly expressed in coordinate basis as
\begin{align}
    R^{\alpha}{}_{\beta\mu\nu} &= \partial_{\mu} \Gamma^{\alpha}{}_{\beta\nu} - \partial_{\nu} \Gamma^{\alpha}{}_{\beta\mu} + \Gamma^{\alpha}{}_{\mu\rho}\Gamma^{\rho}{}_{\beta\nu} - \Gamma^{\alpha}{}_{\nu\rho}\Gamma^{\rho}{}_{\beta\mu}.
\end{align}
The 3-dimensional Ricci tensor $R_{\mu\nu}$ and Ricci scalar $R$ are defined in a similar manner as their 4-dimensional counterparts
\begin{align}
     R_{\mu\nu} &\coloneqq  R^\alpha{}_{\mu\alpha\nu}, & R &\coloneqq  R^{\mu}{}_{\mu}.
\end{align}
Since $R^{\alpha}{}_{\beta\mu\nu}$ is purely spatial and can be computed by the spatial derivatives of the spatial metric alone,
it only contains about information about the curvature intrinsic to the hypersurface $\Sigma_t$,
but cannot contain all the information of ${}^{(4)} R^{\alpha}{}_{\beta\mu\nu}$ which includes time derivative of the 4-dimensional metric.
The missing information can be found in a purely spatial symmetric tensor called the extrinsic curvature $K_{\mu\nu}$.

\subsection{Extrinsic curvature} \label{section1.2.3}
The extrinsic curvature $K_{\mu\nu}$ is related to the time derivative of the spatial metric $\gamma_{\mu\nu}$.
Therefore, the spatial metric and extrinsic curvature $\left(\gamma_{\mu\nu}, K_{\mu\nu} \right)$ are equivalent to the positions and velocities in classical mechanics,
which describe the instantaneous state of the gravitational field.
It can be obtained by projecting of the gradient of the normal vector $\gamma_{\mu}{}^{\lambda}\gamma_{\nu}{}^{\rho} \nabla_{\lambda} n_{\rho}$ into the hypersurface $\Sigma_t$,
and then taking the negative expression of the symmetric part
\begin{align}\label{eq:1.2.3.K1}
\begin{split}
   K_{\mu\nu} \coloneqq& - \gamma_{\mu}{}^{\lambda}\gamma_{\nu}{}^{\rho} \nabla_{\lambda} n_{\rho} \\
   =& - \gamma_{\mu}{}^{\lambda} \left( \delta_{\nu}{}^{\rho} + n_{\nu} n^{\rho} \right) \nabla_{\lambda} n_{\rho} \\
   =& - \gamma_{\mu}{}^{\lambda} \nabla_{\lambda} n_{\nu},
\end{split}
\end{align}
where the identity $n^{\rho}\nabla_{\lambda} n_{\rho}=0$ is used. \\
We can also define an spatial acceleration $a_\nu$
\begin{align}
    a_\nu \coloneqq n^\mu \nabla_\mu n_\nu,
\end{align}
satisfying the identities
\begin{align}
    a_\nu = D_\nu \ln{\alpha},
\end{align}
to rewrite equation(\ref{eq:1.2.3.K1}) as
\begin{align}
    K_{\mu\nu} = - \nabla_\mu n_\nu - n_\mu a_\nu
\end{align}
Finally, we can write the extrinsic curvature $K_{\mu\nu}$ as the Lie derivative of the spatial metric along the local normal $n^\mu$
\begin{align}
    K_{\mu\nu} = - \frac{1}{2} \mathcal{L}_{n} \gamma_{\mu\nu}.
\end{align}
Using equation(\ref{eq:1.2.1.normal_decompose}), we can express the Lie derivative $\mathcal{L}_n$ as
\begin{align}\label{eq:normal_Lie}
    \mathcal{L}_n = \frac{1}{\alpha} \left( \mathcal{L}_t - \mathcal{L}_\beta \right),
\end{align}
and thus obtain the evolution equation for the spatial metric
\begin{align}\label{eq:g_evol}
    \mathcal{L}_t \gamma_{\mu\nu} = - 2\alpha K_{\mu\nu} + \mathcal{L}_\beta \gamma_{\mu\nu}.
\end{align}

\subsection{The Gauss, Codazzi and Ricci equations}
\label{section1.2.4}

To express the Einstein field equations in term of the spatial variables $(\gamma_{\mu\nu}, K_{\mu\nu})$ we defined previously,
we first need to relate 3-dimensional Riemann tensor $R^\alpha{}_{\beta\mu\nu}$ on $\Sigma_t$ to the 4-dimensional Riemann tensor ${}^{(4)}R^\alpha{}_{\beta\mu\nu}$ on $\mathcal{M}$,
The relation between $R^\alpha{}_{\beta\mu\nu}$ and the full spatial projection of ${}^{(4)}R^\alpha{}_{\beta\mu\nu}$ is given by the \textit{Gauss' equation}
\begin{align}\label{eq:Gauss}
    R_{\alpha\beta\mu\nu} + K_{\alpha\mu}K_{\beta\nu} - K_{\alpha\nu} K_{\beta\mu} = \gamma_{\alpha}{}^{\rho} \gamma_{\beta}{}^{\sigma} \gamma_{\mu}{}^{\lambda} \gamma_{\nu}{}^{\delta} {}^{(4)}R_{\rho\sigma\lambda\delta},
\end{align}
while the projection of ${}^{(4)}R^\alpha{}_{\beta\mu\nu}$ with one index projected in the normal direction is given by the \textit{Codazzi equation}
\begin{align}\label{eq:Codazzi}
    D_{\nu} K_{\mu\alpha} - D_{\mu} K_{\nu\alpha} = \gamma_{\mu}{}^{\rho} \gamma_{\nu}{}^{\sigma} \gamma_{\alpha}{}^{\lambda} n^{\delta} {}^{(4)}R_{\rho\sigma\lambda\delta}.
\end{align}
Finally, by projecting two indices of ${}^{(4)}R_{\rho\sigma\lambda\delta}$ in the normal direction,
we can relate it to the time derivative of $K_{\mu\nu}$
\begin{align}\label{eq:Ricci}
    \mathcal{L}_n K_{\mu\nu} = n^{\alpha} n^{\beta} \gamma_{\mu}{}^{\lambda} \gamma_{\nu}{}^{\delta} {}^{(4)}R_{\alpha\deta\beta\lambda} - \frac{1}{\alpha} D_{\mu} D_\nu \alpha - K_{\nu}{}^{\lambda}K_{\mu\lambda},
\end{align}
which is called the \textit{Ricci equation}.

\subsection{Constraint and evolution equations} %Section - 1.2.5
\label{section1.2.5}

Using the Gauss, Codazzi and Ricci equations,
the Einstein fields equations can be decomposed into a set of evolution equations and a set of constraint equations of $(\gamma_{\mu\nu}, K_{\mu\nu})$.
To begin with, we define the following matter quantities
\begin{align}
    S_{\mu\nu} \coloneqq& \gamma^{\alpha}{}_{\mu} \gamma^{\beta}{}_{\nu} T_{\alpha\beta}, \\
    S_\mu \coloneqq& - \gamma^{\alpha}{}_{\mu} n^{\beta} T_{\alpha\beta}, \\
    S \coloneqq& S^\mu{}_\mu, \\
    E \coloneqq& n^\alpha n^\beta T_{\alpha\beta},
\end{align}
which decompose the stress-energy tensor as
\begin{align}\label{eq:T_decompose}
    T_{\mu\nu} = E n_\mu n_\nu + S_\mu n_\nu + S_\nu n_\mu + S_{\mu\nu}.
\end{align}\\
By contracting the $\alpha,\mu$ indices in equation(\ref{eq:Gauss}), we can obtain
\begin{align}\label{eq:Gauss_1st}
    R_{\mu\nu} = \gamma_{\mu}{}^{\alpha}\gamma_{\nu}{}^{\beta} \left( {}^{(4)} R_{\alpha\beta} + n^\rho n^\sigma {}^{(4)}R_{\alpha\rho\beta\sigma} \right) + K_{\mu\lambda} K_\nu{}^{\lambda} - K_{\mu\nu} K,
\end{align}
where $K\coloneqq K^\mu{}_{\mu}$ is the trace of the extrinsic curvature,
called the \textit{mean curvature}.
Further contracting the $\mu, \nu$ indices in equation(\ref{eq:Gauss_1st}), the contracted Gauss' equation becomes
\begin{align}\label{eq:Gaussr_2nd}
    2 n^\mu n^\nu G_{\mu\nu} = R + K^2 - K_{\mu\nu} K^{\mu\nu},
\end{align}
Using the Einstein equation(\ref{eq:Einstein_eq}), we can obtain the \textit{Hamiltonian constraint}
\begin{align}
    R + K^2 - K_{\mu\nu} K^{\mu\nu} = 16\pi E.
\end{align}
Similarly, by contracting $\alpha, \nu$ indices in equation(\ref{eq:Codazzi}), the Codazzi equation yields
\begin{align}
    D_{\nu} K_{\mu}{}^{\nu} - D_\mu K = - 8\pi \gamma^{\alpha}{}_{\mu} n^{\beta} T_{\alpha\beta},
\end{align}
and thus obtain the \textit{momentum constrain equation}
\begin{align}
    D_{\nu} K_{\mu}{}^{\nu} - D_\mu K = 8 \pi S_{\mu}.
\end{align}\\
The Ricci equation (\ref{eq:Ricci}) can be rewritten using equation(\ref{eq:Gauss_1st}) to
\begin{align}
    \mathcal{L}_n K_{\mu\nu} = R_{\mu\nu} - \gamma_{\mu}{}^{\rho} \gamma_\nu{}^{\sigma} {}^{(4)} R_{\rho\sigma} - 2 K_{\mu\lambda} K_\nu{}^{\lambda} + K K_{\mu\nu} - \frac{1}{\alpha} D_\mu D_\nu \alpha.
\end{align}
Using the Einstein equations (\ref{eq:Einstein_eq})
\begin{align}
\begin{split}
    \gamma_{\mu}{}^{\rho} \gamma_\nu{}^{\sigma} {}^{(4)} R_{\rho\sigma} &= 8\pi \gamma_{\mu}{}^{\rho} \gamma_\nu{}^{\sigma} \left( T_{\rho\sigma} - \frac{1}{2}g_{\rho\sigma} T^\mu{}_\mu \right)\\
    &= 8\pi \left[S_{\mu\nu} - \frac{1}{2} \gamma_{\mu\nu} \left(S-E\right) \right]
\end{split}
\end{align}
and equation(\ref{eq:normal_Lie}), we can finally obtain the evolution equation for $K_{\mu\nu}$ as
\begin{align}\label{eq:K_evol}
    \mathcal{L}_t K_{\mu\nu} = - D_\mu D_\nu \alpha + \alpha \left(R_{\mu\nu} - 2K_{\mu\lambda} K_\nu{}^{\lambda} + K K_{\mu\nu} \right) 
    - 8 \pi \alpha \left[ S_{\mu\nu} - \frac{1}{2}\gamma_{\mu\nu} \left(S-E\right) \right] + \mathcal{L}_\beta K_{\mu\nu}.
\end{align}

\subsection{The Arnowitt, Deser and Misner equations} %Section - 1.2.6
\label{section1.2.6}

The Lie derivative in the evolution equations (\ref{eq:g_evol}) and (\ref{eq:K_evol}) can be expressed in terms of coordinate basis as
\begin{align}
    \mathcal{L}_t K_{\mu\nu} &= \partial_t K_{\mu\nu} \\
    \mathcal{L}_\beta K_{\mu\nu} &= \beta^\lambda D_\lambda K_{\mu\nu} + K_{\mu\lambda} D_\nu \beta^\lambda + K_{\lambda\nu} D_\mu \beta^\lambda
\end{align}\\
As the result, the Einstein field equaitons (\ref{eq:Einstein_eq}) in the standard 3+1 decomposition can be decomposed into a set of constraint equations and evolution equation of $(\gamma_{ij}, K_{ij})$ in terms of coordinate basis,
which are referred to as the Arnowitt, Deser and Misner (ADM) equations \cite{amowitt1962dynamics,york1979kinematics}
\begin{flalign}
    & R + K^2 - K_{ij}K^{ij} = 16\pi E, && \text{(Hamiltonian constraint)} \label{eq:ADM_H_const}\\
    & D_j \left(K^{ij} - \gamma^{ij} K \right) = 8\pi S^i, && \text{(momentum constraint)} \label{eq:ADM_S_const}\\
    & \partial_t \gamma_{ij} = - 2 \alpha K_{ij} + D_i \beta_j + D_j \beta_i, && \text{(spatial metric evolution)} \label{eq:ADM_g_evol}\\
    &
    \begin{aligned}
    \partial_t K_{ij} =& - D_i D_j \alpha + \alpha \left(R_{ij} - 2 K_{ik} K_j{}^k + K K_{ij} \right) \\
    &- 8\pi \alpha \left[S_{ij} - \frac{1}{2}\gamma_{ij} \left(S-E \right) \right] \\
    &+ \beta^k D_k K_{ij} + K_{ik} D_j \beta^k + K_{kj} D_i \beta^k.
    \end{aligned} && \text{(extrinsic curvature evolution)} \label{eq:ADM_K_evol}
\end{flalign}

%********************************** % Third Section  *************************************
\section{Conformal Decomposition} %Section - 1.3
\label{section1.3}

The conformal decompostion factors out a scalar component from a spatial metric.
It was first developped for initial data problems in general relativity \cite{lichnerowicz1944integration,york1971gravitational,york1972role,york1973conformally},
and then used in reformulating evolution equations in the 3+1 formulation.
In this section, we will discuss the conformal decomposition of spatial metric and extrinsic curvature in numerical relativity.


\subsection{Conformal transformation of the spatial metric}
\label{section1.3.1}
We consider the conformal transformation of the spatial metric $\gamma_{ij}$ as
\begin{align}\label{eq:conformal_metric}
    \tilde{\gamma}_{ij} = \psi^{-4} \gamma_{ij},
\end{align}
where $\tilde{\gamma}_{ij}$ is the \textit{conformal metric} and $\psi$ is a positive scaling factor satisfying
\begin{align}\label{eq:scaling_factor}
    \psi &\coloneqq \det{\left( \frac{\gamma}{f} \right)}, & \gamma &\coloneqq \det{\left( \gamma_{ij} \right)}, & f &\coloneqq \det{\left( f_{ij} \right)}
\end{align}
for a time independent flat metric $f_{ij}$ (i.e. $\det{\left( \tilde{\gamma}_{ij} \right)} = f$ by construction).\\
Thus, the \textit{inverse conformal metric} is given by
\begin{align}\label{eq:conformal_metric_inv}
    \tilde{\gamma}^{ij} \coloneqq \psi^4 \gamma^{ij}.
\end{align}
Substituting the conformal transformation (\ref{eq:conformal_metric}) into equation(\ref{eq:3_connection}),
we can obtain the transformation law for 3-dimensional connection coefficient
\begin{align}
    \Gamma^{i}{}_{jk} = \tilde{\Gamma}^{i}{}_{jk} + 2 \left( \delta^i{}_j \tilde{D}_k \ln \psi + \delta^i{}_k \tilde{D}_j \ln \psi
    - \tilde{\gamma}_{jk} \tilde{\gamma}^{il} \tilde{D}_l \ln \psi \right).
\end{align}
From now on, we denote all objects associated with the conformal metric $\tilde{\gamma}^{ij}$ with a tilde symbol.
Similarly, the transformation for Ricci tensor and scalar curvature are given by
\begin{align}
\begin{split}
    R_{ij} =& \tilde{R}_{ij} - 2 \left( \tilde{D}_i \tilde{D}_j \ln \psi + \tilde{\gamma}_{ij} \tilde{\gamma}^{lm} \tilde{D}_l \tilde{D}_m \ln \psi \right)\\
    &+ 4 \left[ \left(\tilde{D}_i \ln \psi \right) \left( \tilde{D}_j \ln \psi \right) 
    - \tilde{\gamma}_{ij} \tilde{\gamma}^{lm} \tilde{D}_l \left(\tilde{D}_l \ln \psi \right) \left( \tilde{D}_m \ln \psi \right) \right]
\end{split} \label{eq:conformal_ricci_tensor}\\
    R =& \psi^{-4} \tilde{R} - 8 \psi^{-5} \tilde{D}^2 \psi, \label{eq:conformal_ricci_scalar}
\end{align}
where $\tilde{D}^2 = \tilde{\gamma}^{ij} \tilde{D}_i \tilde{D}_j$ denotes the Laplace operator associated with $\tilde{\gamma}_{ij}$.
Therefore, using equation(\ref{eq:conformal_ricci_scalar}), the Hamiltonian constraint (\ref{eq:ADM_H_const}) becomes
\begin{align}
    8 \tilde{D}^2 \psi - \psi \tilde{R} - \psi^5 K^2 + \psi^2 K_{ij} K^{ij} = - 16 \pi \psi^5 E.
\end{align}

\subsection{Conformal transformation of the extrinsic curvature}
\label{section1.3.2}

\subsubsection{Traceless decomposition}
\label{section1.3.2.1}
Before we perform the conformal transformation to the extrinsic curvature $K_{ij}$, it is convenient to split $K_{ij}$ into the trace part 
\begin{align}
    K \coloneqq \gamma^{ij} K_{ij},
\end{align}
and its traceless part
\begin{align}
    A_{ij} &\coloneqq K_{ij} - \frac{1}{3} \gamma_{ij} K, & \operatorname{tr}_{\gamma} A_{ij} &= \gamma^{ij} A_{ij} = 0.
\end{align}
Therefore, we can obtain the tracelss decomposition of the extrinsic curvature
\begin{align}
    K_{ij} &= A_{ij} + \frac{1}{3} \gamma_{ij} K, & K^{ij} &= A^{ij} + \frac{1}{3} \gamma^{ij} K.
\end{align}
The evolution equations of the spatial metric (\ref{eq:ADM_g_evol}) in conformal decomposition formulation can hence be written as
\begin{flalign}
    \partial_t \psi &= \beta^i \tilde{D}_i \psi - \frac{1}{6}\psi \left(\alpha K - \tilde{D}_i \beta^i \right), &&\text{(conformal factor evolution)} \label{eq:psi_evol} \\
    \partial_t \tilde{\gamma}_{ij} &= - 2\alpha \psi^{-4} A_{ij} + \tilde{\gamma}_{jk} \tilde{D}_i \beta^k + \tilde{\gamma}_{ik} \tilde{D}_j \beta^k - \frac{2}{3} \tilde{\gamma}_{ij} \tilde{D}_k \beta^k, &&\text{(conformal metric evolution)} \label{eq:con_g_evol_1}
\end{flalign}
and the constraint equations become
\begin{flalign}
    &\tilde{D}^2 \psi - \frac{1}{8} \psi \tilde{R} + \left( \frac{1}{8} A_{ij} A^{ij} - \frac{1}{12}K^2 + 2 \pi E \right) \psi^5 = 0, 
    &&\text{(Hamiltonian constraint)} \label{eq:H_const_s} \\
    &\tilde{D}_j \left(\psi^{10} A^{ij} \right) - \frac{2}{3}\psi^6 \tilde{D}^i K = 8\pi \psi^{10} S^i. 
    &&\text{(momentum constraint)} \label{eq:S_const_s}
\end{flalign}

\subsubsection{Conformal transformation of the traceless part}
\label{section1.3.2.2}
We consider the transformation
\begin{align}
    A^{ij} \coloneqq \psi^a \tilde{A}^{ij},
\end{align}
for some undetermined exponent $\alpha$.
Here, we discuss two natural choices of $a$: $a = -4$ and $a = -10$.

\subparagraph{“Time-evolution” scaling: $a=-4$.}
This choice of scaling was considered by Nakamura in 1994 \cite{nakamura19943d},
It comes naturally from the evolution equation of conformal metric (\ref{eq:con_g_evol_1}),
where the $\psi^{-4}A_{ij}$ term suggests the conformal transformation of $A_{ij}$ to have the same scaling factor as the conformal spatial metric (\ref{eq:conformal_metric_inv})
\begin{align}
    \tilde{A}^{ij} \coloneqq \psi^4 A^{ij},
\end{align}
where the indices of $\tilde{A}^{ij}$ and $\tilde{A}_{ij}$ are lowered and raised by the conformal metric $\tilde{\gamma}_{ij}$ and $\tilde{\gamma}^{ij}$ respectively
(i.e. $\tilde{A}_{ij} = \tilde{\gamma}_{il}\tilde{\gamma}_{jm}\tilde{A}^{lm} = \psi^{-4} A_{ij}$).
The evolution equations of conformal spatial metric therefore become
\begin{align}
    \partial_t \tilde{\gamma}_{ij} &= - 2\alpha \tilde{A}_{ij} + \tilde{\gamma}_{jk} \tilde{D}_i \beta^k + \tilde{\gamma}_{ik} \tilde{D}_j \beta^k - \frac{2}{3} \tilde{\gamma}_{ij} \tilde{D}_k \beta^k.
\end{align}
The Hamiltonian constraint and momentum constraint in this scaling is rewritten as
\begin{align}
    &\tilde{D}^2 \psi = \frac{1}{8} \psi \tilde{R} - \left( 2 \pi E - \frac{1}{12}K^2 + \frac{1}{8} \tilde{A}_{ij} \tilde{A}^{ij} \right) \psi^5, 
    \label{eq:H_const_s4}\\
    &\tilde{D}_j \left(\psi^6 \tilde{A}^{ij} \right) - \frac{2}{3}\psi^6 \tilde{D}^i K = 8\pi \psi^{10} S^i.\label{eq:S_const_s4}
\end{align}

\subparagraph{“Momentum-constraint” scaling: $a=-10$.}
Another possible choice of scaling factor $a=-10$ originates from the momentum constraint equation (\ref{eq:S_const_s}),
which was first suggested by Lichnerowicz in 1944 \cite{lichnerowicz1944integration}.
we define
\begin{align}
    \hat{A}^{ij} \coloneqq \psi^{10} A^{ij},
\end{align}
and thus
\begin{align}
    \hat{A}_{ij} = \psi^{2} A_{ij}.
\end{align}
Here, we use hat symbol to separate the "momentum-constraint" scaling from the tilde symbol in "time-evolution" scaling.
These two scaling are related by
\begin{align}
    \hat{A}^{ij}&= \psi^6\tilde{A}^{ij}, &\hat{A}_{ij} &= \psi^6 \tilde{A}_{ij}, &\hat{A}_{ij} \hat{A}^{ij} &= \psi^{12} \tilde{A}_{ij} \tilde{A}^{ij}
\end{align}
Therefore, the constraint equations can be written as
\begin{align}
    &\tilde{D}^2 \psi = \frac{1}{8} \psi \tilde{R} - \left( 2\pi E - \frac{1}{12}K^2 \right) \psi^5 - \frac{1}{8} \hat{A}_{ij} \hat{A}^{ij} \psi^{-7}, 
    \label{eq:H_const_s10}\\
    &\tilde{D}_i \hat{A}^{ij} - \frac{2}{3}\psi^6 \tilde{D}^i K = 8\pi \psi^{10} S^i.\label{eq:S_const_s10}
\end{align}
Equation(\ref{eq:S_const_s10}) is known as \textit{Lichnerowicz equation}.
Although equation (\ref{eq:S_const_s4}) and equation (\ref{eq:S_const_s10}) are equivalent,
they have different mathematical properties if they are treated as a partial differential equation for $\psi$.
According to the maximal principle,
the local uniqueness of the solutions depends on the sign of the exponent of $\psi$ in the quadratic extrinsic curvature $A^2$ term 
\cite{cordero2009improved,smarr1979sources,taylor1991partial,evans1997partial,protter2012maximum}.
Equation (\ref{eq:H_const_s4}) suffers from the mathematical non-uniqueness problems due to the positive exponent $(+5)$,
while the negative exponent $(-7)$ in equation (\ref{eq:H_const_s10}) guarantees the local uniqueness of the solutions.

\subsection{Conformal transverse-traceless decomposition}
\label{section1.3.3}
Using the "momentum-constraint” scaling mentioned previously,
we can further decompose the symmetric, traceless tensor $\hat{A}^{ij}$ as
\begin{align}\label{eq:CTT}
    \hat{A}^{ij} = \hat{A}^{ij}_{TT} + \hat{A}^{ij}_{L},
\end{align}
where $\hat{A}^{ij}_{TT}$ is the transverse-traceless part which is divergenceless
\begin{align}
    \tilde{D}_j \hat{A}^{ij}_{L} = 0,
\end{align}
and $\hat{A}^{ij}_{L}$ is the longitudinal part satisfying
\begin{align}
    \hat{A}^{ij}_{L} = \tilde{D}^i X^j + \tilde{D}^j X^i - \frac{2}{3}\tilde{\gamma}^{ij} \tilde{D}_k X^k \equiv \left(\tilde{L} X \right)^{ij}.
\end{align}
The vector $X^i$ here is the vector potential 
and $\tilde{L}$ is the \textit{longitudinal operator} or \textit{conformal Killing operator} associated with $\tilde{\gamma}$
which gives a symmetric, traceless tensor.
The divergence of $\hat{A}^{ij}$ becomes
\begin{align}\label{eq:vector_Lap}
    \tilde{D}_j \hat{A}^{ij} = \tilde{D}^2 X^i + \frac{1}{3} \tilde{D}^i \left( \tilde{D}_j X^j \right) + \tilde{R}^i{}_j X^j \equiv \tilde{\Delta}_{L},
\end{align}
where $\tilde{\Delta}_{L}$ is the \textit{vector Laplacian}.
Thus, the momentum constraint in the conformal transverse-traceless (CTT) decomposition yields
\begin{align}\label{eq:CTT_S_const}
    \tilde{\Delta}_L X^i - \frac{2}{3}\psi^6 \tilde{D}^i K = 8 \pi \psi^{10} S^i,
\end{align}
and the corresponding Hamiltonian constraint is the same as equation (\ref{eq:H_const_s10}).

%********************************** % Fourth Section  *************************************
\section{Gauge Condition}  %Section - 1.4
\label{section1.4}
In the 3+1 formulation of spacetime, the gauge freedom is preserved.
One can freely choose the lapse function $\alpha$ and shift vector $\beta^i$.
In this section, we introduce the \textit{maximal slicing} condition and \textit{generalized Dirac gauge},
which is used in the formulation of the constrained scheme in the next section.

\subsection{Maximal Slicing} 
\label{section1.4.1}
By taking the trace of the evolution equation for extrinsic curvature (\ref{eq:ADM_K_evol}),
we can obtain an elliptic equation for the lapse $\alpha$
\begin{align}\label{eq:lapse_1}
    D^2 \alpha = - \partial_t K + \alpha \left[ K_{ij} K^{ij} + 4\pi\left(E+S\right) \right] + \beta^i D_i K.
\end{align}
One well-known choice to further simplify this equation is the \textit{maximal slicing} condition
\begin{align}\label{eq:max_slicing}
    K = 0 = \partial_t K,
\end{align}
which corresponds to the vanishing mean curvature in all hypersurface $\Sigma_t$.
This type of slicing was first introduced by Lichnerowicz \cite{lichnerowicz1944integration}
and then made popularized by York \cite{smarr1979sources,smarr1978radiation}.
Under this condition, the enclosed volume inside some hypersurface $\Sigma_t$ becomes maximal,
hence the name \textit{maximal slicing}.
With this choice of condition, equation (\ref{eq:lapse_1}) reduces to
\begin{align}\label{eq:lapse_2}
    D^2 \alpha = \alpha \left[ A_{ij} A^{ij} + 4\pi\left(E+S\right) \right],
\end{align}
which is independent of the shift $\beta^i$.
Alternatively, we can combine the conformally decomposed Hamiltonian equation (\ref{eq:H_const_s10}) to obtain
\begin{align}\label{eq:lapse_con}
    \tilde{D}^2 \left(\alpha \psi \right) = \alpha \psi \left[ \frac{7}{8} \psi^{-8} \hat{A}_{ij} \hat{A}^{ij} + \frac{1}{8} \tilde{R}
    + 2 \pi \psi^4 \left(E + 2 S \right) \right].
\end{align}
The \textit{maximal slicing} condition not only helps decouple the constraint equations,
but also has some nice physical properties:
it is a natural extension of Newtonian gravity and has singularity avoidance property.

\subsubsection{Natural generalization to Newtonian limit}
Consider the Newtonian limit of a weak and static gravitational field
\begin{align}
    \alpha &\approx 1 + \Phi, & \gamma_{ij} &\approx \left(1 + 2\Phi \right) f_{ij}, & K_{ij} &=0, & \text{for } \Phi &\ll 1,
\end{align}
where $\Phi$ is the Newtonian gravitational potential,
and non-relativistic matter
\begin{align}
    S &\ll E, & E &\approx \rho_0,
\end{align}
where $\rho_0$ is the proper rest mass energy density.
Equation (\ref{eq:lapse_2}) reduces to Poisson equation for the Newtonian gravitational potential
\begin{align}
    \nabla^2 \Phi = 4\pi \rho_0.
\end{align}

\subsubsection{Singularity avoidance}
Another interesting property of maximal slicing is singularity avoidance.
Equation (\ref{eq:1.2.3.K1}) shows that under maximal slicing condition,
the normal observers move like irrotational and incompressible fluid elements
\begin{align}
    \nabla_\mu n^{\mu} = 0,
\end{align}
which implies that focusing of the timelike unit normal vector field is prohibited.
It can also be seen from equation (\ref{eq:ADM_g_evol}),
which yields the following continuity equation for volume element $\sqrt{\gamma}$ in maximal slicing condition
\begin{align}\label{eq:volume_evol}
    \partial_t \sqrt{\gamma} = \partial_i \left( \sqrt{\gamma} \beta^i \right).
\end{align}
This suggests that as long as a regular shift vector is chosen
and the initial condition for $\gamma_{\mu\nu}$ is regular,
$\gamma$ is regular forever.

\subsection{Generalized Dirac Gauge}
\label{section1.4.2}
The \textit{Dirac gauge} was first introduced by Dirac in 1959 \cite{dirac1959fixation},
and then generalized by the Meudon group \cite{bonazzola2004constrained}.
We define the \textit{generalized Dirac gauge} as
\begin{align}\label{eq:dirac_gauge_1}
    \mathcal{D}_j \tilde{\gamma}^{ij} = 0,
\end{align}
which fully specify the coordinates in the hypersurface $\Sigma_t$ including the initial one.
Here, $\mathcal{D}$ denotes the covariant derivative associated with the flat background metric $f_{ij}$ defined in equation (\ref{eq:scaling_factor}),
which relates $\tilde{D}$ by
\begin{align}
    \tilde{D}_k T^{i_1 \dots i_p}{}_{j_1 \dots j_q} = \mathcal{D}_k T^{i_1 \dots i_p}{}_{j_1 \dots j_q} 
    + \sum_{r=1}^p \Delta^{i_r}{}_{lk} T^{i_1 \dots l \dots i_p}{}_{j_1 \dots j_q}
    + \sum_{r=1}^q \Delta^{l}{}_{j_r k} T^{i_1 \dots i_p}{}_{j_1 \dots l \dots j_q},
\end{align}
where $\Delta^{k}{}_{ij}$ is given by
\begin{align}
    \Delta^k{}_{ij} \coloneqq& \frac{1}{2} \tilde{\gamma}^{kl} \left( \mathcal{D}_i \tilde{\gamma}_{lj} + \mathcal{D}_j \tilde{\gamma}_{il}
    - \mathcal{D}_l \tilde{\gamma}_{ij} \right).
\end{align}
We can further define the potentials $h^{ij}$ as the deviation of the conformal metric from the flat fiducial metric
\begin{align}
    h^{ij} \coloneqq \tilde{\gamma}^{ij} - f^{ij}.
\end{align}
Thus, the generalized Dirac is equivalent to
\begin{align}
    \mathcal{D}_j h^{ij} = 0,
\end{align}
Under such gauge condition, the conformal Ricci tensor $\tilde{R}^{ij}$ is simplified drastically as
\begin{align}
    \tilde{R}^{ij} = \frac{1}{2} \mathcal{D}^2 h^{ij} + \tilde{R}^{ij}_{*},
\end{align}
where $\tilde{R}^{ij}_{*}$ is the quadratic part of $\tilde{R}^{ij}$
\begin{align}
    \tilde{R}^{ij}_{*} &\coloneqq \frac{1}{2} \biggl[ h^{kl} \mathcal{D}_k \mathcal{D}_l h^{ij} - \mathcal{D}_l h^{ik} \mathcal{D}_k h^{jl}
    - \tilde{\gamma}_{kl} \tilde{\gamma}^{mn} \mathcal{D}_m h^{ik} \mathcal{D}_n h^{jl} \\
    & + \tilde{\gamma}_{nl} \mathcal{D}_k h^{mn} \left( \tilde{\gamma}^{ik} \mathcal{D}_m h^{jl} + \tilde{\gamma}^{jk} \mathcal{D}_m h^{il} \right)
    + \frac{1}{2} \tilde{\gamma}^{ik} \tilde{\gamma}^{kl} \mathcal{D}_l h^{mn} \mathcal{D}_k \tilde{\gamma}_{mn} \biggr],
\end{align}
and $\mathcal{D}^2 = \mathcal{D}^i \mathcal{D}_i$ is the Laplacian operator associated with the flat metric with $\mathcal{D}^i \coloneqq f^{ij}\mathcal{D}_j$.
The curvature scalar $\tilde{R}$ of the conformal metric does not contain any second order derivative of $\tilde{\gamma}_{ij}$ thanks to the gauge condition
\begin{align}
    \tilde{R} = \frac{1}{4} \tilde{\gamma}^{kl} \mathcal{D}_k h^{ij} \mathcal{D}_l \tilde{\gamma}_{ij} 
    - \frac{1}{2} \tilde{\gamma}^{kl} \mathcal{D}_k h^{ij} \mathcal{D}_j \tilde{\gamma}_{il}.
\end{align}
Note that the generalized gauge condition result in transverse-traceless (TT) gauge asymtotically,
which are well adapted to the treatment of gravitational radiation.

%********************************** % Fifth Section  *************************************
\section{Constrained scheme for the Einstein equations}  %Section - 1.5
\label{section1.5}
Although the ADM equations (\cref{eq:ADM_H_const,eq:ADM_S_const,eq:ADM_g_evol,eq:ADM_K_evol}) formulate the Einstein equations into a well-defined initial-value problem based on spacetime foliation,
it is known to be unsuitable for numerical simulation of singular spacetime due to the unbounded growth of numerical error (same for conformal decomposition formulation).
Several reformulations were developed to maintain stable evolutions.
Most of schemes such as BSSN \cite{shibata1995evolution,baumgarte1998numerical}, CCZ4 \cite{bona2003general}, Z4c \cite{bernuzzi2010constraint} schemes are based on free-evolution approach where the hyperbolic-type dynamical equations are evolved without enforcing the constraints.
The constraint equations are solved only to obtain the initial data and serve as an indicator for numerical errors during the simulation.
On the other hand, the fully constrained approach minimizes the hyperbolic-type evolution equations by solving the constraint equations at each time step.
Though the elliptic nature of the constraint equations makes it computationally costly to solve,
elliptic equations are more stable than hyperbolic equations,
and the constraint-violating modes appeared in the free-evolution scheme vanish by construction in fully constrained evolution.\\
With the efficient elliptic multigrid solvers developed,
our relativistic hydrodynamics code \texttt{Gmunu} employs the Isenberg–Wilson–Mathews (also known as conformal flatness condition) approximation to the general relativity
and the fully constrained formulation.
In this section, we introduce the formulations and implementations under the constrained scheme.

\subsection{Isenberg–Wilson–Mathews approximation}  %Section - 1.5.1
\label{section1.5.1}
The Isenberg–Wilson–Mathews approximation (IWM), also known as conformal flatness condition (CFC),
is a (gravitational-)waveless approximation to general relativity which was independently developed by
Isenberg in 1978 \cite{isenberg2008waveless} as well as Wilson and Mathews in 1989 \cite{wilson1989relativistic}.
In IWM, the spatial metric is approximated to be conformally flat (hence the name conformal flatness condition)
\begin{align}
    \gamma_{ij} &= \psi^4 f_{ij}, &\text{or } &\text{equivalently } & \tilde{\gamma}_{ij} &= f_{ij},
\end{align}
under maximal slicing condition $K=0=\partial_t K$ (\cref{eq:max_slicing})
(i.e. $\partial_t \tilde{\gamma}_{ij} = 0$ and $\tilde{D}_i=\mathcal{D}_i$ by construction).
The equations for the conformal factor and extrinsic curvature can be obtained from equations (\ref{eq:psi_evol}) and (\ref{eq:con_g_evol_1}) respectively
\begin{align}
    \partial_t \psi &= \beta^i \mathcal{D}_i \psi + \frac{\psi}{6} \mathcal{D}_i \beta^i \\
    K_{ij} &= \frac{\psi^4}{2\alpha} \left(f_{jk} \mathcal{D}_i \beta^k + f_{ik} \mathcal{D}_j \beta^k - \frac{2}{3} f_{ij} \mathcal{D}_k \beta^k \right) 
    \label{eq:K_CFC}.
\end{align}
The CFC approximation reduces the ADM equations in a set of coupled non-linear elliptic equations for $\psi$ (from \cref{eq:H_const_s4}), $\alpha$ (from \cref{eq:lapse_con}), and $\beta^i$ (from \cref{eq:S_const_s4})
\begin{align}
    & \mathcal{D}^2 \psi = - \left( 2\pi E + \frac{1}{8}K_{ij} K^{ij} \right) \psi^5, \\
    & \mathcal{D}^2 \left(\alpha \psi \right) = \alpha \psi^5 \left[ \frac{7}{8} K_{ij} K^{ij} + 2 \pi \left(E + 2 S \right) \right], \\
    & \Delta_L \beta^i = 16 \pi \alpha \psi^4 S^i + 2 \psi^{10} K^{ij} \mathcal{D}_j \left(\alpha \psi^{-6} \right),
\end{align}
where $\Delta_L \beta^i \coloneqq \mathcal{D}^2 \beta^i + \frac{1}{3} \mathcal{D}^i \mathcal{D}_j \beta^j$
is the \textit{vector Laplacian} (\cref{eq:vector_Lap}) associated with the flat metric $f_{ij}$.
Although the solutions $(\psi, \alpha, \beta^i)$ to the CFC system do not satisfy all the conformal 3+1 equations in general,
it is exact for spherically symmetric spacetime \cite{cordero2011maximal} and
correct at the 1-PN order in the post-Newtonian expansion of general relativity.
The CFC scheme has been successful in numerical simulation for various astrophysical simulation
\cite{dimmelmeier2002relativistic,oechslin2002conformally,saijo2004collapse,bauswein2012equation,bauswein2013systematics,bauswein2014revealing,muller2015dynamics,dimmelmeier2006non} 
and obtained good approximation to full general relativity in axisymmetric rotating neutron stars 
\cite{shibata2004gravitational,dimmelmeier2002relativistic,dimmelmeier2006non,cook1996testing}
and in rotating iron core collapses \cite{ott2007rotating}.

\subsubsection{Extended CFC scheme}
\label{section_XCFC}
Despite the success of CFC scheme in astrophysical simulation,
it suffers from the non-uniqueness issue as we discussed in section \ref{section1.3.2.2}.
A solution to this has been found \cite{cordero2009improved,saijo2004collapse,shibata2006merger},
which involves an extra elliptic equation of the vector potential from CTT decomposition (see section \ref{section1.3.3}).
The resultant scheme is called \textit{extended conformal flatness approximation} (XCFC),
and the metric can be solved by following
\begin{align}
    & \Delta_L X^i = 8\pi f^{ij} \left(S^{*}\right)_j, \label{eq:XCFC_X}\\
    & \mathcal{D}^2 \psi = - 2\pi E^{*} \psi^{-1} - \frac{1}{8} \psi^{-7}f_{il}f_{jm} \hat{A}^{lm} \hat{A}^{ij}, \label{eq:XCFC_psi}\\
    & \mathcal{D}^2 \left(\alpha \psi \right) = \left( \alpha \psi \right) \left[ 2\pi \left( E^{*} + 2 S^{*} \right) \psi^{-2}
    + \frac{7}{8} \psi^{-8} f_{il}f_{jm} \hat{A}^{lm} \hat{A}^{ij} \right], \label{eq:XCFC_alp}\\
    & \Delta_L \beta^i = 16 \pi \alpha \psi^{-6} f^{ij} \left(S^{*}\right)_{j} + 2 \hat{A}^{ij} \mathcal{D}_j \left(\alpha \psi^{-6} \right), \label{eq:XCFC_beta}
\end{align}
where the hydrodynamical conserved quantities are defined as
\begin{align}
    E^* &\coloneqq \psi^6 E, & S^* & \coloneqq \psi^6 S, & \left(S^*\right)_i &\coloneqq \psi^6 S_i,
\end{align}
and the extra vector elliptic equation (\ref{eq:XCFC_X}) comes from the momentum constraint (\cref{eq:CTT_S_const}) 
by taking CFC approximation and $\hat{A}^{ij}_{TT} \approx 0$ in CTT decomposition (\cref{eq:CTT}),
which gives
\begin{align}\label{eq:XCFC_A}
    \hat{A}^{ij} \approx \mathcal{D}^i X^j + \mathcal{D}^j X^i - \frac{2}{3} f^{ij} \mathcal{D}_k X^k \equiv \left(LX \right)^{ij}.
\end{align}
Unlike the coupled system in IWM approximation, the XCFC system is decoupled in a hierarchical way,
and hence guarantees local uniqueness.
Once the hydrodynamical conserved quantities are known,
the metric equations can be solved accordingly as follows
\begin{Step}
    \item Solve equation (\ref{eq:XCFC_X}) for the vector potential $X^i$ from the conserved variables $\left(S^*\right)_i$.
    \item Obtain $\hat{A}^{ij}$ from equation (\ref{eq:XCFC_A}).
    \item Solve equation (\ref{eq:XCFC_psi}) for the conformal factor $\psi$.
    \item Work out $S^*$ using conformal factor $\psi$.
    \item Solve equation (\ref{eq:XCFC_alp}) for the lapse function $\alpha$.
    \item Solve equation (\ref{eq:XCFC_beta}) for the shift vector $\beta^i$.
\end{Step}

\subsection{The Meudon-Valencia Fully Constrained Formulation}  %Section - 1.5.2
\label{section1.5.2}
The fully constrained formulation (FCF) was first proposed by the Meudon group \cite{bonazzola2004constrained},
and then later modified by the Valencia's group \cite{cordero2008mathematical,cordero2009improved,cordero2012gravitational}.
By choosing the maximal slicing condition (section \ref{section1.4.1}) and the generalized Dirac gauge (section \ref{section1.4.2}),
the conformal 3+1 decomposition can be recast in a coupled elliptic-hyperbolic system,
where all the constraint equations are utilized to minimize the number of hyperbolic equations in the system.
Here, we summarize the gauge conditions and algebraic constraint for the scheme
\begin{flalign}
    &K \coloneqq \gamma_{ij} K^{ij} = 0, &&\text{(maximal slicing condition)} \label{eq:FCF_max_slicing}\\
    & \mathcal{D}_j h^{ij} = 0, &&\text{(generalized Dirac gauge)} \label{eq:FCF_dirac}\\
    & \det \tilde{\gamma}_{ij} = f, &&\text{(conformal decomposition)} \label{eq:FCF_conformal_g}\\
    & K^{ij} = \psi^{-10}\hat{A}^{ij}, \quad \hat{A}^{ij} = \hat{A}^{ij}_{TT} + \left(L X\right)^{ij}. &&\text{(conformal decomposition)} \label{eq:FCF_conformal_A}
\end{flalign}
Note that although it would be more general to used the \textit{Killing operator} $\tilde{L}$ associated with $\tilde{\gamma}_{ij}$ in equation (\ref{eq:FCF_conformal_A}),
the \textit{Killing operator} $L$ associated with flat metric $f_{ij}$ is used since it is easier to handle technically.
Under such gauge conditions, the ADM equations are decomposed into a coupled hyperbolic-elliptic system.

\subsubsection{Hyperbolic sector}
The Valencia's group performed first-order reduction \cite{cordero2008mathematical} to the reduced FCF system \cite{bonazzola2004constrained} by introducing auxiliary variable
\begin{align}
    w^{ij}{}_k \coloneqq \mathcal{D}_k h^{ij},
\end{align}
with the gauge condition
\begin{align}\label{eq:FCF_conformal_w}
    w^{ij}{}_i = 0.
\end{align}
Thus, the hyperbolic sector in the FCF is recast as a first-order system in $\left(h^{ij}, \hat{A}^{ij}, w^{ij}{}_k \right)$ as follows
\begin{flalign}
    &\partial_t h^{ij} = 2 \alpha \psi^{-6} \hat{A}^{ij} + \beta^k w^{ij}{}_k
    - \tilde{\gamma}^{ik} \mathcal{D}_k \beta^j - \tilde{\gamma}^{kj} \mathcal{D}_k \beta^i
    + \frac{2}{3}\tilde{\gamma}^{ij} \mathcal{D}_k \beta^k, \label{eq:FCF_h}\\
    &\begin{aligned}
        \partial_t \hat{A}^{ij} =& \mathcal{D}_k \left( \frac{1}{2}\alpha \psi^2 \tilde{\gamma}^{kl} w^{ij}{}_l
        + \beta^k \hat{A}^{ij} \right) - \hat{A}^{kj} \mathcal{D}_k \beta^i - \hat{A}^{ik} \mathcal{D}_k \beta^j
        + \frac{2}{3}\hat{A}^{ij} \mathcal{D}_k \beta^k
        + 2\alpha \psi^{-6} \tilde{\gamma}^{kl} \hat{A}^{ik} \hat{A}^{jl} \\
        &- 8 \pi \alpha \psi^6 \left( \psi^4 S^{ij} -\frac{1}{3}\tilde{\gamma}^{ij} S \right)
        + \alpha \psi^2 \left( \tilde{R}^{ij}_* - \frac{1}{3} \tilde{R} \right)
        + 8\alpha 
        \left( \tilde{\gamma}^{ik} \tilde{\gamma}^{jl}  -\frac{1}{3} \tilde{\gamma}^{ij} \tilde{\gamma}^{kl} \right)
        \mathcal{D}_k \psi \mathcal{D}_l \psi \\
        & + 4 \psi 
        \left( \tilde{\gamma}^{ik} \tilde{\gamma}^{jl} + \tilde{\gamma}^{il} \tilde{\gamma}^{jk} - \frac{2}{3} \tilde{\gamma}^{kl} \tilde{\gamma}^{ij}\right)
        \mathcal{D}_k \psi \mathcal{D}_l \alpha
        - \left( \tilde{\gamma}^{ik} \tilde{\gamma}^{jl} - \frac{1}{3} \tilde{\gamma}^{ij} \tilde{\gamma}^{kl} \right)
        \mathcal{D}_k \mathcal{D}_l \left(\alpha \psi^2 \right) \\
        &- \frac{1}{2} \left( \tilde{\gamma}^{ik} w^{lj}{}_k + \tilde{\gamma}^{lk} w^{il}{}_k \right) \mathcal{D}_l \left(\alpha \psi^2 \right),
    \end{aligned} \label{eq:FCF_A}\\
    &\partial_t w^{ij}{}_k = \mathcal{D}_k \left(2 \alpha \psi^{-6} \hat{A}^{ij} + \beta^k w^{ij}{}_k
    - \tilde{\gamma}^{ik} \mathcal{D}_k \beta^j - \tilde{\gamma}^{kj} \mathcal{D}_k \beta^i
    + \frac{2}{3}\tilde{\gamma}^{ij} \mathcal{D}_k \beta^k\right), \label{eq:FCF_w}
\end{flalign}
where $\tilde{R}^{ij}_*$ and $\tilde{R}$ defined in section \ref{section1.4.2}.
This evolution system is proved to be strongly hyperbolic \cite{cordero2008mathematical} under following conditions
\begin{align}
    \alpha &\neq 0, & \alpha^2 - \beta^i \beta_i &> 0,
\end{align}
and the characteristic speed is given by
\begin{align}
    \lambda^i_{\pm} = -\beta^i \pm \alpha\psi^{-2} \tilde{\gamma}^{ii}.
\end{align}
In Meudon-Valencia's approach, only the transverse-traceless (TT) part of the hyperbolic equations are evolved.
Each tensor hyperbolic equation is reduced to two scalar equations under TT decomposition \cite{bonazzola2004constrained} and solved using spectral method,
and partially implicit Runge-Kutta methods (PIRK) is used to update $w^{ij}{}_k$ to maintain numerical stability \cite{cordero2012gravitational,cordero2012partially}.
To fulfill the constraint in equation (\ref{eq:FCF_conformal_g}), the trace part of $h^{ij}$ was calculated by the following iteration procedure:
\begin{Step}
    \item Calculate $h\coloneqq \det{\tilde{\gamma}^{ij}} - f$.
    \item Solve the Poisson equation
    \begin{align}\label{eq:FCF_g_trace}
        \mathcal{D}^2 \Phi = h.
    \end{align}
    \item Update $h^{ij}$ by $h^{ij}_{(new)} = h^{ij}_{(old)} + \frac{1}{2} \left( h f^{ij} - \mathcal{D}^i \mathcal{D}^j \Phi \right)$.
    \item Repeat step 1 to 3 until the $\det{\tilde{\gamma}^{ij}} = f$ is satisfied.
\end{Step}

\subsubsection{Elliptic sector}
The elliptic sector in the FCF scheme is given by
\begin{align}
    &\tilde{\gamma}^{kl} \mathcal{D}_k \mathcal{D}_l X^i + \frac{1}{3}\tilde{\gamma}^{ik}\mathcal{D}_k \mathcal{D}_l X^l
    + \Delta^i{}_{kl} \left( LX \right)^{kl} = 8\pi \tilde{\gamma}^{ij} \left( S^* \right)_j - \Delta^i{}_{kl} \hat{A}^{kl}_{TT}, \label{eq:FCF_X}\\
    & \tilde{\gamma}^{kl} \mathcal{D}_k \mathcal{D}_l \psi = - 2\pi E^* \psi^{-1} 
    - \frac{1}{8} \psi^{-7} \tilde{\gamma}_{il} \tilde{\gamma}_{jm} \hat{A}^{lm} \hat{A}^{ij} + \frac{1}{8}\psi \tilde{R}, \label{eq:FCF_psi}\\
    & \tilde{\gamma}^{kl} \mathcal{D}_k \mathcal{D}_l \left( \alpha \psi \right) = \left(\alpha\psi\right)
    \left[ 2\pi\psi^{-2} \left(E^* + 2 S^* \right) + \frac{7}{8}\psi^{-8}\tilde{\gamma}_{il} \tilde{\gamma}_{jm} \hat{A}^{lm} \hat{A}^{ij}
    + \frac{\tilde{R}}{8}\right], \label{eq:FCF_alp} \\
    &\tilde{\gamma}^{kl} \mathcal{D}_k \mathcal{D}_l \beta^i + \frac{1}{3}\tilde{\gamma}^{ik}\mathcal{D}_k \mathcal{D}_l \beta^l =
    16 \pi \alpha \psi^{-6} \tilde{\gamma}^{ij} \left( S^* \right)_j + 2 \hat{A}^{ij} \mathcal{D}_j \left(\alpha \psi^{-6} \right)
    - 2 \alpha \psi^{-6} \Delta^i{}_{kl} \hat{A}^{kl}, \label{eq:FCF_beta}
\end{align}
which can be solved following the same routine as XCFC scheme (section \ref{section_XCFC}).
Note that the FCF scheme is a natural generalization of XCFC scheme 
since it reduces to XCFC if the approximation $h^{ij} = \hat{A}^{ij}_{TT} = 0$ is made.

\subsubsection{passive FCF}
The elliptic sector in FCF scheme is technically more difficult to solve.
Therefore, the Valencia's group an approximation scheme based on FCF, called passive FCF \cite{cordero2012gravitational},
which neglected the backreaction of the GWs onto the dynamics of the system.
Unlike the XCFC which sets the gravitational radiation to zero,
the gravitational wave can be evolved in passive FCF scheme by keeping the hyperbolic sector in FCF scheme,
while solving the elliptic sector in XCFC scheme.

\subsection{The fully-constrained scheme in \texttt{Gmunu}}
\label{section1.5.3}
In \texttt{Gmunu}, the fully-constrained scheme is solved in a slightly different approach.
Instead of solving \cref{eq:FCF_h,eq:FCF_A,eq:FCF_w},
we omit the auxiliary variable $w^{ij}{}_k$ in order to avoid solving the gauge condition of $w^{ij}{}_k$ \ref{eq:FCF_conformal_w} and evolve the following hyperbolic equations for $\left(h^{ij}, A^{ij} \right)$
\begin{flalign}
    &\partial_t h^{ij} = 2 \alpha \psi^{-6} \hat{A}^{ij} + \beta^k \mathcal{D}_k h^{ij}
    - \tilde{\gamma}^{ik} \mathcal{D}_k \beta^j - \tilde{\gamma}^{kj} \mathcal{D}_k \beta^i
    + \frac{2}{3}\tilde{\gamma}^{ij} \mathcal{D}_k \beta^k, \label{eq:FCF_h_2}\\
    &\begin{aligned}
        \partial_t \hat{A}^{ij} =& \frac{1}{2} \alpha \psi^2 \tilde{\gamma}^{kl} \mathcal{D}_k \mathcal{D}_l h^{ij}{}
        + \beta^k \mathcal{D}_k \hat{A}^{ij} - \hat{A}^{kj} \mathcal{D}_k \beta^i - \hat{A}^{ik} \mathcal{D}_k \beta^j
        + \frac{5}{3}\hat{A}^{ij} \mathcal{D}_k \beta^k
        + 2\alpha \psi^{-6} \tilde{\gamma}^{kl} \hat{A}^{ik} \hat{A}^{jl} \\
        &- 8 \pi \alpha \psi^6 \left( \psi^4 S^{ij} -\frac{1}{3}\tilde{\gamma}^{ij} S \right)
        + \alpha \psi^2 \left( \tilde{R}^{ij}_* - \frac{1}{3} \tilde{R} \right)
        + 8\alpha 
        \left( \tilde{\gamma}^{ik} \tilde{\gamma}^{jl}  -\frac{1}{3} \tilde{\gamma}^{ij} \tilde{\gamma}^{kl} \right)
        \mathcal{D}_k \psi \mathcal{D}_l \psi \\
        & + 4 \psi 
        \left( \tilde{\gamma}^{ik} \tilde{\gamma}^{jl} + \tilde{\gamma}^{il} \tilde{\gamma}^{jk} - \frac{2}{3} \tilde{\gamma}^{kl} \tilde{\gamma}^{ij}\right)
        \mathcal{D}_k \psi \mathcal{D}_l \alpha
        - \left( \tilde{\gamma}^{ik} \tilde{\gamma}^{jl} - \frac{1}{3} \tilde{\gamma}^{ij} \tilde{\gamma}^{kl} \right)
        \mathcal{D}_k \mathcal{D}_l \left(\alpha \psi^2 \right) \\
        &- \frac{1}{2} \left( \tilde{\gamma}^{ik} \mathcal{D}_k h^{lj}+ \tilde{\gamma}^{lk} \mathcal{D}_k h^{il} - \tilde{\gamma}^{kl} \mathcal{D}_k h^{ij} \right) 
        \mathcal{D}_l \left(\alpha \psi^2 \right),
    \end{aligned} \label{eq:FCF_A_2}
\end{flalign}
directly without performing TT composition.
Note that although the hyperbolic system is \textit{unconditionally unstable} if second-order explicit \textit{Runge-Kutta} (RK) method used,
it has shown to be numerically stable using fourth-order explicit RK method \cite{cordero2012partially,shibata2015numerical}.
In \texttt{Gmunu}, the hyperbolic sector in FCF scheme is evolving simultaneously with the hydrodynamical system using 
fourth-order \textit{strong stability-preserving Runge-Kutta} (ssprk) methods.
For spatial derivative, fourth-order upwind finite difference is used for the advection terms \cite{shibata2015numerical}
(i.e. $\mathcal{D}_k h^{ij}$ in \cref{eq:FCF_h_2} and $\mathcal{D}_k \hat{A}^{ij}$ in \cref{eq:FCF_A_2}),
and fourth-order central finite difference is used for other derivative terms.\\
After the time integration is done,
we need to modify $\left(h^{ij}_{old}, \hat{A}^{ij}_{old}\right)$ so that the gauge conditions can be satisfied.
The generalized Dirac gauge condition is then enforced by \textit{elliptic divergence cleaning} method as follows
\begin{Step}
    \item Solve the \textit{vector Laplacian} equation
    \begin{align}
        \Delta_L W^i = \mathcal{D}_j h^{ij}_{(old)}.
    \end{align}
    \item Update $h^{ij}$ by
    \begin{align}
        h^{ij}_{(new)} = h^{ij}_{(old)} - \left( L W \right)^{ij}.
    \end{align}
\end{Step}
This treatment is inspired by the divergence cleaning of magnetic monopole in magnetohydrodynamics \cite{balsara2004comparison,teunissen2019geometric,balsara1998total}.
In \textit{Gmunu}, a fourth-order central finite difference scheme is used for $\mathcal{D}_j h^{ij}_{old}$,
and a second-order central finite difference scheme is used for $\Delta_L W^i$ and $\left( L W \right)^{ij}$.
To enforce the algebraic constraint (\ref{eq:FCF_conformal_g}),
we modify the trace part of $h^{ij}$ using the same routine described in section \ref{section1.5.2}.\\
For $\hat{A}^{ij}$, it can be modified by the following procedures:
\begin{Step}
    \item Obtain the traceless part of $\hat{A}^{ij}_{(old)}$ by
    \begin{align}
        \hat{A}^{ij}_{(1)} = \hat{A}^{ij}_{(old)} - \frac{1}{3} f^{ij} f_{kl} \hat{A}^{kl}_{(old)}.
    \end{align}
    \item Calculate the vector potential $X^i$ using momentum constraint
    \begin{align} \label{eq:FCF_X_2}
    &\tilde{\gamma}^{kl} \mathcal{D}_k \mathcal{D}_l X^i + \frac{1}{3}\tilde{\gamma}^{ik}\mathcal{D}_k \mathcal{D}_l X^l
    + \Delta^i{}_{kl} \left( LX \right)^{kl} = 8\pi \tilde{\gamma}^{ij} \left( S^* \right)_j 
    - \Delta^i{}_{kl} \hat{A}^{kl}_{(1)} - \mathcal{D}_j \hat{A}^{ij}_{(1)}.
    \end{align}
    Note that differing from equation (\ref{eq:FCF_X}), $\hat{A}^{ij}_{(1)}$ is used on the right-hand-side instead of $\hat{A}^{ij}_{TT}$.
    Thus, the vector potential $X^i$ here is an additional longitudinal part for $\hat{A}^{ij}$ to satisfy the momentum constraint.
    \item Update $\hat{A}^{ij}$ by
    \begin{align}
        \hat{A}^{ij}_{(new)} = \hat{A}^{ij}_{(1)} + \left( L X \right)^{ij}.
    \end{align}
\end{Step}
The remaining unknowns $\left(\psi, \alpha, \beta^i\right)$ can then be solved accordingly by adopting the same procedure in section \ref{section1.5.2}.\\
Note that we follow the Meudon-Valencia approach and solve the metric variables in orthonormal basis.

\subsubsection{Boundary condition}
In \texttt{Gmunu}, we impose the following boundary conditions for the metric variables at the outermost boundary $(r=r_{max})$
\begin{align}
    \left.\frac{\partial \psi}{\partial r}\right|_{r=r_{max}} &= \frac{1-\psi}{r},
    &\left.\frac{\partial \alpha}{\partial r}\right|_{r=r_{max}} &= \frac{1-\alpha}{r}, \\
    \left.\frac{\partial \beta^i}{\partial r}\right|_{r=r_{max}} &= -\frac{\beta^i}{r},
    &\left.\frac{\partial X^i}{\partial r}\right|_{r=r_{max}} &= -\frac{X^i}{r}, 
    &\left.\frac{\partial W^i}{\partial r}\right|_{r=r_{max}} &= -\frac{W^i}{r}.
\end{align}
We assume that asymptotically $h^{ij}$ satisfies the linearized quadruple wave equation \cite{teukolsky1982linearized}
\begin{align}
    &\frac{\partial h^{rr}}{\partial t} + \frac{\partial h^{rr}}{\partial r} + \frac{3 h^{rr}}{r} = 0, \\
    &\frac{\partial h^{r\theta}}{\partial t} + \frac{\partial h^{r\theta}}{\partial r} + \frac{2 h^{r\theta}}{r} = 0, \\
    &\frac{\partial h^{r\phi}}{\partial t} + \frac{\partial h^{r\phi}}{\partial r} + \frac{2 h^{r\phi}}{r} = 0, \\
    &\frac{\partial h^{\theta\theta}}{\partial t} + \frac{\partial h^{\theta\theta}}{\partial r} + \frac{h^{\theta\theta}}{r} = 0, \\
    &\frac{\partial h^{\theta\phi}}{\partial t} + \frac{\partial h^{\theta\phi}}{\partial r} + \frac{h^{\theta\phi}}{r} = 0, \\
    &\frac{\partial h^{\phi\phi}}{\partial t} + \frac{\partial h^{\phi\phi}}{\partial r} + \frac{h^{\phi\phi}}{r} = 0,
\end{align}
and similarly for $\hat{A}^{ij}$.
This boundary condition can be rewritten as \cite{shibata1995evolution}
\begin{align}
    Q(t,r) &= \left(1 - \frac{\Delta r}{r} \right)^n Q(t-\Delta t, r - \Delta r),
\end{align}
for $Q(t,r)$ in the Sommerfield form
\begin{align}
    &\frac{\partial Q}{\partial t} + \frac{\partial Q}{\partial r} + \frac{n Q}{r} = 0,
\end{align}
where $\Delta t$ is the time step, $\Delta r = \alpha \psi^-2 \Delta t$
and $Q(t-\Delta t, r - \Delta r)$ is obtained by the second-order interpolation from the nearby mesh points.
