%!TEX root = ../thesis.tex
% ******************************* Thesis Appendix B ********************************

\chapter{Reference flat metric in 3D}\label{A2}
Here we list the cell volume $\Delta V$, the cell surface $\Delta A^i$ and the 
volume-averaged of 3-Christoffel symbols $\left\langle \hat{\Gamma}^i{}_{jk} \right\rangle$
used in the finite-volume conservative methods \ref{section3.1.1}with reference metric $\hat{\gamma}_{ij}$ under different geometries.

\section{Cylindrical coordinate}
The reference metric in cylindrical coordinate is given by
\begin{align}
    \hat{\gamma}_{ij} &=
    \begin{pmatrix}
        1 & 0 & 0 \\
        0 & 1 & 0 \\
        0 & 0 & r^2
    \end{pmatrix}.
\end{align}
The associated 3-Christoffel symbols $\hat{\Gamma}^i{}_{jk}$ are given by
\begin{flalign}
    \hat{\Gamma}^r{}_{ij} &=
    \begin{pmatrix}
        0 & 0 & 0 \\
        0 & 0 & 0 \\
        0 & 0 & -r
    \end{pmatrix},&
    \hat{\Gamma}^z{}_{ij} &=
    \begin{pmatrix}
        0 & 0 & 0 \\
        0 & 0 & 0 \\
        0 & 0 & 0
    \end{pmatrix},&
    \hat{\Gamma}^\phi{}_{ij} &=
    \begin{pmatrix}
        0 & 0 & \frac{1}{r} \\
        0 & 0 & 0 \\
        \frac{1}{r} & 0 & 0
    \end{pmatrix}.
\end{flalign}
We define the following notations
\begin{align}
    r_\pm &\coloneqq r \pm \frac{1}{2}\Delta r, & z_\pm &\coloneqq z \pm \frac{1}{2}\Delta z, &\phi_\pm &\coloneqq \phi \pm \frac{1}{2}\Delta \phi,
\end{align}
where $\left(r,z,\phi\right)$ is the location of the cell center and $\left(\Delta r, \Delta z, \Delta \phi\right)$ is the grid size of the cell.
Therefore, the cell volume $\Delta V$, the cell surface $\Delta A^i$ and the volume-averaged 3-Christoffel symbols $\left\langle \hat{\Gamma}^i{}_{jk} \right\rangle$ are given by:
\begin{align}
    \Delta V &= r \Delta r \Delta z \Delta \phi, \\
    \left. \Delta A^r \right|_{r_\pm} &= r_\pm \Delta z \Delta \phi, \\
    \left. \Delta A^z \right|_{z_\pm} &= r \Delta r \Delta \phi, \\
    \left. \Delta A^\phi \right|_{\phi_\pm} &= r \Delta r \Delta z, \\
    \left\langle \hat{\Gamma}^r{}_{\phi\phi} \right\rangle &= -\frac{1}{r}\left(r^2 + \frac{\left(\Delta r\right)^2}{12} \right), \\
    \left\langle \hat{\Gamma}^\phi{}_{r\phi} \right\rangle &= \left\langle \hat{\Gamma}^\phi{}_{\phi r} \right\rangle = \frac{1}{r}.
\end{align}

\section{Spherical coordinate}
The reference metric in spherical coordinate is given by
\begin{align}
    \hat{\gamma}_{ij} &=
    \begin{pmatrix}
        1 & 0 & 0 \\
        0 & r^2 & 0 \\
        0 & 0 & r^2\sin^2\theta
    \end{pmatrix}.
\end{align}
The associated 3-Christoffel symbols $\hat{\Gamma}^i{}_{jk}$ are given by
\begin{flalign}
    \hat{\Gamma}^r{}_{ij} &=
    \begin{pmatrix}
        0 & 0 & 0 \\
        0 & -r & 0 \\
        0 & 0 & -r\sin^2\theta
    \end{pmatrix},&
    \hat{\Gamma}^\theta{}_{ij} &=
    \begin{pmatrix}
        0 & \frac{1}{r} & 0 \\
        \frac{1}{r} & 0 & 0 \\
        0 & 0 & -\sin\theta \cos\theta
    \end{pmatrix},&
    \hat{\Gamma}^\phi{}_{ij} &=
    \begin{pmatrix}
        0 & 0 & \frac{1}{r} \\
        0 & 0 & \cot\theta \\
        \frac{1}{r} & \cot\theta & 0
    \end{pmatrix}.
\end{flalign}
We define the following notations
\begin{align}
    r_\pm &\coloneqq r \pm \frac{1}{2}\Delta r, & \theta_\pm &\coloneqq \theta \pm \frac{1}{2}\Delta \theta, & \phi_\pm &\coloneqq \phi \pm \frac{1}{2}\Delta \phi,
\end{align}
where $\left(r,\theta,\phi\right)$ is the location of the cell center and $\left(\Delta r, \Delta \theta, \Delta \phi\right)$ is the grid size of the cell.
Therefore, the cell volume $\Delta V$, the cell surface $\Delta A^i$ and the volume-averaged 3-Christoffel symbols $\left\langle \hat{\Gamma}^i{}_{jk} \right\rangle$ are given by:
\begin{align}
    \Delta V &= 2 \left(r^2 + \frac{\left(\Delta r\right)^2}{12} \right) \sin\theta \sin{\left(\frac{\Delta\theta}{2}\right)}\Delta r \Delta \phi, \\
    \left. \Delta A^r \right|_{r_\pm} &= 2 r_\pm^2 \sin\theta \sin{\left(\frac{\Delta\theta}{2}\right)} \Delta \phi, \\
    \left. \Delta A^\theta \right|_{\theta_\pm} &= \left(r^2 + \frac{\left(\Delta r\right)^2}{12} \right) \sin\theta_\pm \Delta r \Delta \phi, \\
    \left. \Delta A^\phi \right|_{\phi_\pm} &= 2 \left(r^2 + \frac{\left(\Delta r\right)^2}{12} \right) \sin\theta \sin{\left(\frac{\Delta\theta}{2}\right)} \Delta r, \\
    \left\langle \hat{\Gamma}^\theta{}_{r\theta} \right\rangle &= 
    \left\langle \hat{\Gamma}^\theta{}_{\theta r} \right\rangle = 
    \left\langle \hat{\Gamma}^\phi{}_{r\phi} \right\rangle = 
    \left\langle \hat{\Gamma}^\phi{}_{\phi r} \right\rangle = \frac{2}{\Delta V} \left( r \sin\theta \sin{\left(\frac{\Delta\theta}{2}\right)} \Delta r \Delta \phi \right), \\
    \left\langle \hat{\Gamma}^r{}_{\theta\theta} \right\rangle &= - \frac{1}{2 \Delta V}\left(r_+^4 - r_-^4 \right) \sin\theta \sin{\left(\frac{\Delta\theta}{2}\right)} \Delta r \Delta \phi, \\
    \left\langle \hat{\Gamma}^r{}_{\phi\phi} \right\rangle &= - \frac{1}{4 \Delta V}\left(r_+^4 - r_-^4 \right) 
            \left.\left(\frac{1}{3}\cos^3\theta - \cos\theta \right)\right|^{\theta_+}_{\theta_-} \Delta \phi, \\
    \left\langle \hat{\Gamma}^\theta{}_{\phi\phi} \right\rangle &= -\frac{1}{3\Delta V}\left(r^2 + \frac{\left(\Delta r\right)^2}{12} \right)
            \left( \sin^3\theta_+ - \sin^3\theta_- \right) \Delta r \Delta \phi, \\
    \left\langle \hat{\Gamma}^\phi{}_{\theta\phi} \right\rangle &= 
    \left\langle \hat{\Gamma}^\phi{}_{\phi\theta} \right\rangle = \cot\theta.
\end{align}

